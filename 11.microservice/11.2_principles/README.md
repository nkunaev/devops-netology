# Микросервисы: принципы

## Задача 1: API Gateway

-------

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:

*    маршрутизация запросов к нужному сервису на основе конфигурации,
*    возможность проверки аутентификационной информации в запросах,
*    обеспечение терминации HTTPS.

Учитывая, что речь идет о веб-сервисе, то выбор то не особенно большой. 
Касаемо программных комплексов, это Apache2 или Nginx.

Характеристики и сходства/отличия

|Функционал| Apache                                                                                                                                                                                                                     | Nginx                                                                                                                                                                                                 |
|---|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|Архитектура обработки соединений| Apache предоставляет несколько модулей мультипроцессинга (multi-processing modules, MPM), которые отвечают за то как запрос клиента будет обработан. Это позволет администраторам определять политику обработки соединений | Nginx спроектирован на базе асинхронных неблокирующих event-driven алгоритмов                                                                                                                         |
|Статический и динамический контент| Может раздавать статический и динамичекий контент используя стандартные file-based методы.                                                                                                                                 | Nginx не имеет возможности самостоятельно обрабатывать запросы к динамическому контенту.                                                                                                              |
|Распределенная конфигурация против централизованной| Apache имеет опцию, которая позволяет включить конфигурирование на уровне директорий                                                                                                                                       | Nginx не интерпретирует файлы .htaccess и не предоставляет механизм конфигурирования на уровне директорий за пределами основного конфигурационного файла.                                             |
|Интерпретация базирующаяся на файлах и URI| Apache имеет возможность интерпретировать запрос как физический ресурс в файловой системе или как URI, который требует дополнительной обработки                                                                            | Nginx создан, чтобы работать и в качестве веб-сервера, и в качестве прокси-сервера. По этой причине он работает в первую очередь с URI, транслируя их при необходимости в запросы к файловой системе. |
|Модули| +                                                                                                                                                                                                                          | +                                                                                                                                                                                                     |

Также существуют облачные решения, например AWS/Yandex/Google API Gateway  
И проприетарные/опенсорсные решения, например [Kong](https://konghq.com/products/kong-gateway) или [Tyk](https://tyk.io/pricing-cloud/)

В Базовом исполнении можно реализовать самопальный аналог APY Gateway через NGINX, поскольку он удовлетворяет всем требованяим, так:  
* безопасность - HTTP-AUTH
* Маршрутизация на основе конфигурации 
* Поддержка HTTP(S)

Для реализации в Kubernetes может подойти Kong, который используется как ingress контроллер.

Для облачных решений API Gateway от соответсвующих провайдеров. Из приятных бонусов (заманух), в небольших масшабах использование указанных сервисов является бесплатным.


## Задача 2: Брокер сообщений
-------

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

| требование\Решение                                    | Apache Kafka | Redis | RabbitMQ               | Amazon MQ/Yandex Kafka |
|-------------------------------------------------------|--------------|-------|------------------------|------------------------|
| поддержка кластеризации для обеспечения надёжности    | +            | +     | +/- сложно настраивать | cloud                  |
| хранение сообщений на диске в процессе доставки       | +            |       |                        | cloud                  |
| высокая скорость работы                               | +            | +     |                        | +                      |
| поддержка различных форматов сообщений                | +            | +     | +                      | +                      |
| разделение прав доступа к различным потокам сообщений | +            | +     | +                      | +                      |
| простота эксплуатации                                 | +            | +     | +                      | +                      |


В данном случае удовлетворяет всем требованиям Apache Kafka, а также облачные решения. Окончательный выбор будет обусловлен бюджетом организации, 
текущей архитектурой приложений, а также пранируемым вектором развития организации.